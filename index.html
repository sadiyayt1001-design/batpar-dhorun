<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶¨‡¶æ‡¶ü‡¶™‡¶æ‡¶∞ ‡¶ß‡¶∞‡ßÅ‡¶®</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<style>
body{font-family:sans-serif;background:#e8f5e9;margin:0;padding:0;}
.container{width:95%;max-width:500px;margin:10px auto;padding:10px;}
h1,h2{text-align:center;color:#212121;}
input,textarea{width:100%;padding:10px;margin:5px 0;border-radius:8px;border:1px solid #ccc;}
button{padding:10px 15px;margin:5px 0;width:48%;border:none;border-radius:8px;color:#fff;font-weight:bold;cursor:pointer;}
button.login{background:#f44336;} button.register{background:#4caf50;} button.searchBtn{background:#388e3c;}
button.submit{background:#4caf50;} button.approve{background:#4caf50;} button.reject{background:#f44336;}
button.like{background:#f44336;} button.dislike{background:#d32f2f;}
.postCard,.commentDiv{background:#fff;padding:10px;margin:8px 0;border-radius:10px;box-shadow:0 2px 5px rgba(0,0,0,0.2);}
img{max-width:100%;border-radius:8px;margin-top:5px;}
#complaintsSection{display:none;}
#adminSection{display:none;}
.commentDiv{border-top:1px dotted #aaa;padding:3px;margin:3px 0;}
</style>
</head>
<body>

<div class="container">
<h1>‡¶¨‡¶æ‡¶ü‡¶™‡¶æ‡¶∞ ‡¶ß‡¶∞‡ßÅ‡¶®</h1>

<!-- User Registration/Login -->
<h2>Account ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶® / Login</h2>
<input type="text" id="userMobile" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
<input type="password" id="userPass" placeholder="Password">
<input type="text" id="userName" placeholder="‡¶®‡¶æ‡¶Æ (Registration Only)">
<button class="register" onclick="registerUser()">Register</button>
<button class="login" onclick="loginUser()">Login</button>
<p id="currentUserDisplay"></p>
</div>

<div class="container" id="complaintsSection">

<h2>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶æ‡¶∞‡¶£‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá?</h2>

<!-- Search Complaint -->
<input type="text" id="searchMobile" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶® (‡¶∏‡¶æ‡¶∞‡ßç‡¶ö)">
<button class="searchBtn" onclick="searchComplaints()">Search</button>
<div id="searchResults"></div>

<hr>

<!-- Submit Complaint -->
<h2>‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶®</h2>
<input type="text" id="cName" placeholder="‡¶®‡¶æ‡¶Æ">
<input type="text" id="cMobile" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
<input type="text" id="cFraud" placeholder="‡¶™‡ßç‡¶∞‡¶§‡¶æ‡¶∞‡¶£‡¶æ‡¶∞ ‡¶ß‡¶∞‡¶®">
<input type="text" id="cTransaction" placeholder="Transaction / Payment">
<input type="file" id="cScreenshot">
<button class="submit" onclick="submitComplaint()">Submit Complaint</button>

<hr>

<!-- Bottom Section -->
<h2>‡¶¨‡¶æ‡¶ü‡¶™‡¶æ‡¶∞ ‡¶¶‡ßá‡¶∞ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h2>
<div id="posts"></div>
</div>

<!-- Admin Login -->
<div class="container">
<h2>Admin Login</h2>
<input type="text" id="adminUser" placeholder="Username">
<input type="password" id="adminPass" placeholder="Password">
<button onclick="adminLogin()">Login</button>
</div>

<div class="container" id="adminSection">
<h2>Admin Panel</h2>
<div id="adminPanel"></div>
<button onclick="logoutAdmin()">Logout</button>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAIkxqhWez_3WzHwAVi3gzX5pS8oIWeQ9g",
    authDomain: "batpar-dhorun.firebaseapp.com",
    projectId: "batpar-dhorun",
    storageBucket: "batpar-dhorun.appspot.com",
    messagingSenderId: "301385643343",
    appId: "1:301385643343:web:dd79b7e751662e5620c13a",
    measurementId: "G-74H5JEMPN5"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();

  let currentUserId = null;
  let currentUserName = "";

  // ---------------- User Registration/Login ----------------
  function registerUser(){
    const mobile=document.getElementById('userMobile').value;
    const pass=document.getElementById('userPass').value;
    const name=document.getElementById('userName').value;
    if(!mobile||!pass||!name){alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®"); return;}
    db.collection('users').add({mobile,password:pass,name}).then(()=>alert("Account ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá! Login ‡¶ï‡¶∞‡ßÅ‡¶®"));
  }
  function loginUser(){
    const mobile=document.getElementById('userMobile').value;
    const pass=document.getElementById('userPass').value;
    db.collection('users').where('mobile','==',mobile).where('password','==',pass)
      .get().then(snapshot=>{
        if(snapshot.empty){alert("Invalid Credentials"); return;}
        currentUserId=snapshot.docs[0].id;
        currentUserName=snapshot.docs[0].data().name;
        document.getElementById('currentUserDisplay').innerText="Logged in as: "+currentUserName;
        document.getElementById('complaintsSection').style.display="block";
        loadAllPosts();
      });
  }

  // ---------------- Submit Complaint ----------------
  async function submitComplaint(){
    const name=document.getElementById('cName').value;
    const mobile=document.getElementById('cMobile').value;
    const fraud=document.getElementById('cFraud').value;
    const transaction=document.getElementById('cTransaction').value;
    const file=document.getElementById('cScreenshot').files[0];
    if(!name||!mobile||!fraud){alert("Name, Mobile, Fraud Type required"); return;}
    let fileURL="";
    if(file){
      const storageRef=storage.ref("screenshots/"+Date.now()+"_"+file.name);
      await storageRef.put(file);
      fileURL=await storageRef.getDownloadURL();
    }
    db.collection("complaints").add({
      name,mobile,fraud_type:fraud,transaction,screenshot:fileURL,
      status:"pending",date:new Date()
    }).then(()=>alert("Complaint Submitted! Waiting for Admin Approval"));
  }

  // ---------------- Search Complaints ----------------
  function searchComplaints(){
    const mob=document.getElementById('searchMobile').value;
    if(!mob){alert("‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®"); return;}
    db.collection("complaints").where("mobile","==",mob).where("status","==","approved")
      .get().then(snapshot=>{
        const div=document.getElementById('searchResults');
        div.innerHTML="";
        if(snapshot.empty){div.innerHTML="‡¶ï‡ßã‡¶®‡¶ì ‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø"; return;}
        snapshot.forEach(doc=>{
          const data=doc.data();
          const p=document.createElement('div');
          p.className="postCard";
          p.innerHTML=`<b>${data.name}</b> (${data.mobile})<br>
                       Fraud: ${data.fraud_type}<br>
                       Transaction: ${data.transaction}<br>
                       ${data.screenshot?`<img src="${data.screenshot}">`:''}`;
          div.appendChild(p);
        });
      });
  }

  // ---------------- Bottom Section ----------------
  function loadAllPosts(){
    db.collection("complaints").where("status","==","approved")
      .orderBy("date","desc").onSnapshot(snapshot=>{
        const postsDiv=document.getElementById('posts');
        postsDiv.innerHTML="";
        snapshot.forEach(doc=>{
          const data=doc.data();
          const div=document.createElement('div');
          div.className="postCard";
          div.innerHTML=`<b>${data.name}</b> (${data.mobile})<br>
                         Fraud: ${data.fraud_type}<br>
                         Transaction: ${data.transaction}<br>
                         ${data.screenshot?`<img src="${data.screenshot}">`:''}
                         <br><button class="like" onclick="reactPost('${doc.id}','like')">Like</button>
                         <button class="dislike" onclick="reactPost('${doc.id}','dislike')">Dislike</button>
                         <span id="count_${doc.id}">üëç 0 | üëé 0</span>
                         <br><input type="text" id="comment_${doc.id}" placeholder="Comment">
                         <button onclick="commentPost('${doc.id}')">Comment</button>
                         <div id="comments_${doc.id}"></div>`;
          postsDiv.appendChild(div);
          updatePostCounts(doc.id);
          loadComments(doc.id);
        });
      });
  }

  // ---------------- Like / Dislike ----------------
  function reactPost(postId,type){
    if(!currentUserId){alert('Login First'); return;}
    const ref=db.collection('postInteractions').doc(postId+'_'+currentUserId);
    ref.set({postId,userId:currentUserId,type},{merge:true}).then(()=>updatePostCounts(postId));
  }
  function updatePostCounts(postId){
    db.collection('postInteractions').where('postId','==',postId).get().then(snapshot=>{
      let likes=0,dislikes=0;
      snapshot.forEach(doc=>{
        if(doc.data().type==="like") likes++;
        else if(doc.data().type==="dislike") dislikes++;
      });
      document.getElementById('count_'+postId).innerText=`üëç ${likes} | üëé ${dislikes}`;
    });
  }

  // ---------------- Comments ----------------
  function commentPost(postId){
    if(!currentUserId){alert('Login First'); return;}
    const text=document.getElementById('comment_'+postId).value;
    if(!text) return;
    db.collection('comments').add({postId,userId:currentUserId,username:currentUserName,commentText:text,timestamp:new Date()})
      .then(()=>{document.getElementById('comment_'+postId).value="";loadComments(postId);});
  }
  function loadComments(postId){
    db.collection('comments').where('postId','==',postId).orderBy('timestamp','asc').get().then(snapshot=>{
      const cDiv=document.getElementById('comments_'+postId);
      cDiv.innerHTML="";
      snapshot.forEach(doc=>{
        const c=doc.data();
        cDiv.innerHTML+=`<div class="commentDiv"><b>${c.username}:</b> ${c.commentText}</div>`;
      });
    });
  }

  // ---------------- Admin ----------------
  function adminLogin(){
    const user=document.getElementById('adminUser').value;
    const pass=document.getElementById('adminPass').value;
    if(user==="tarikul" && pass==="2026583"){
      document.getElementById('adminSection').style.display="block";
      loadAdminPanel();
    } else alert("Invalid Admin Credentials");
  }
  function logoutAdmin(){document.getElementById('adminSection').style.display="none";}
  function loadAdminPanel(){
    db.collection("complaints").where("status","==","pending").onSnapshot(snapshot=>{
      const panel=document.getElementById('adminPanel'); panel.innerHTML="";
      snapshot.forEach(doc=>{
        const data=doc.data();
        const div=document.createElement('div'); div.className="postCard";
        div.innerHTML=`<b>${data.name}</b> (${data.mobile})<br>
                       Fraud: ${data.fraud_type}<br>
                       Transaction: ${data.transaction}<br>
                       ${data.screenshot?`<a href="${data.screenshot}" target="_blank">View Screenshot</a><br>`:''}
                       <button class="approve" onclick="approveComplaint('${doc.id}')">Approve</button>
                       <button class="reject" onclick="rejectComplaint('${doc.id}')">Reject</button>`;
        panel.appendChild(div);
      });
    });
  }
  function approveComplaint(id){db.collection("complaints").doc(id).update({status:"approved"});}
  function rejectComplaint(id){db.collection("complaints").doc(id).delete();}
</script>
</body>
</html>
