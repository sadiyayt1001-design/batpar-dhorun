<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>বাটপার ধরুন</title>

<style>
body{font-family:sans-serif;background:#e8f5e9;margin:0;max-width:450px;margin:auto}
.card{background:#fff;padding:15px;margin:10px;border-radius:10px;box-shadow:0 0 5px #ccc}
input,textarea{width:100%;padding:10px;margin:5px 0;border-radius:5px;border:1px solid #ccc}
button{width:100%;padding:10px;margin:5px 0;border:none;border-radius:5px}
.red{background:#f44336;color:#fff}
.green{background:#4caf50;color:#fff}
.post img{width:100%;margin-top:5px;border-radius:5px}
</style>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyAIkxqhWez_3WzHwAVi3gzX5pS8oIWeQ9g",
authDomain:"batpar-dhorun.firebaseapp.com",
projectId:"batpar-dhorun",
storageBucket:"batpar-dhorun.firebasestorage.app",
messagingSenderId:"301385643343",
appId:"1:301385643343:web:dd79b7e751662e5620c13a"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

let role="user";

window.register=async function(){
await setDoc(doc(db,"users",rmobile.value),{
name:rname.value,
password:rpass.value,
role:"user"
});
alert("Registered");
}

window.login=async function(){
let d=await getDoc(doc(db,"users",lmobile.value));
if(d.exists() && d.data().password==lpass.value){
localStorage.setItem("user",lmobile.value);
role=d.data().role;
loginbox.style.display="none";
home.style.display="block";
loadApproved();
if(role=="admin") adminPanel.style.display="block";
if(role=="moderator") modPanel.style.display="block";
}else alert("Wrong");
}

window.postComplaint=async function(){
await addDoc(collection(db,"pendingPosts"),{
name:scname.value,
mobile:scmobile.value,
amount:amount.value,
details:details.value,
fb:fb.value,
wa:wa.value,
user:localStorage.getItem("user")
});
alert("Submitted");
}

window.loadPending=async function(){
let q=await getDocs(collection(db,"pendingPosts"));
pending.innerHTML="";
q.forEach(d=>{
pending.innerHTML+=`
<div class=card>
<h3>${d.data().name}</h3>
<button class=green onclick="approve('${d.id}')">Approve</button>
<button class=red onclick="reject('${d.id}')">Reject</button>
</div>`
})
}

window.approve=async function(id){
let d=await getDoc(doc(db,"pendingPosts",id));
await addDoc(collection(db,"approvedPosts"),d.data());
await deleteDoc(doc(db,"pendingPosts",id));
loadApproved();
}

window.reject=async function(id){
await deleteDoc(doc(db,"pendingPosts",id));
loadPending();
}

window.loadApproved=async function(){
let q=await getDocs(collection(db,"approvedPosts"));
approved.innerHTML="";
q.forEach(d=>{
approved.innerHTML+=`
<div class="card post">
<h3>${d.data().name}</h3>
<p>${d.data().mobile}</p>
<p>${d.data().amount}</p>
<p>${d.data().details}</p>
<p>FB: ${d.data().fb}</p>
</div>`
})
}

window.resetPass=async function(){
await updateDoc(doc(db,"users",umobile.value),{password:npass.value});
alert("Password Updated");
}

window.addMod=async function(){
await updateDoc(doc(db,"users",modmobile.value),{role:"moderator"});
alert("Moderator Added");
}

window.removeMod=async function(){
await updateDoc(doc(db,"users",modmobile.value),{role:"user"});
alert("Moderator Removed");
}

</script>
</head>

<body>

<div id="loginbox" class="card">
<h2>লগইন করুন</h2>
<input id="lmobile" placeholder="Mobile">
<input id="lpass" placeholder="Password">
<button class="red" onclick="login()">Login</button>

<h3>আইডি তৈরী করুন</h3>
<input id="rname" placeholder="Name">
<input id="rmobile" placeholder="Mobile">
<input id="rpass" placeholder="Password">
<button class="green" onclick="register()">Register</button>
</div>

<div id="home" style="display:none">

<div class="card">
<h3>Complaint Submit</h3>
<input id="scname" placeholder="Scammer Name">
<input id="scmobile" placeholder="Mobile">
<input id="amount" placeholder="Amount">
<textarea id="details" placeholder="Details"></textarea>
<input id="fb" placeholder="Facebook ID">
<input id="wa" placeholder="WhatsApp">
<button class="green" onclick="postComplaint()">Submit</button>
</div>

<div id="approved"></div>

<div id="adminPanel" class="card" style="display:none">
<h3>Admin Panel</h3>
<input id="umobile" placeholder="User Mobile">
<input id="npass" placeholder="New Password">
<button class="red" onclick="resetPass()">Reset Password</button>

<input id="modmobile" placeholder="Moderator Mobile">
<button class="green" onclick="addMod()">Add Moderator</button>
<button class="red" onclick="removeMod()">Remove Moderator</button>

<button onclick="loadPending()">Load Pending Posts</button>
<div id="pending"></div>
</div>

<div id="modPanel" class="card" style="display:none">
<h3>Moderator Panel</h3>
<button onclick="loadPending()">Load Pending Posts</button>
<div id="pending"></div>
</div>

</div>

</body>
</html>
