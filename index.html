<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>বাটপার ধরুন</title>

<style>
body{font-family:sans-serif;background:#e8f5e9;margin:0;max-width:450px;margin:auto}
.card{background:#fff;padding:15px;margin:10px;border-radius:10px;box-shadow:0 0 5px #ccc}
input,textarea{width:100%;padding:10px;margin:5px 0;border-radius:5px;border:1px solid #ccc}
button{width:100%;padding:10px;margin:5px 0;border:none;border-radius:5px}
.red{background:#f44336;color:#fff}
.green{background:#4caf50;color:#fff}
.post img{width:100%;margin-top:5px;border-radius:5px}
</style>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAIkxqhWez_3WzHwAVi3gzX5pS8oIWeQ9g",
  authDomain: "batpar-dhorun.firebaseapp.com",
  projectId: "batpar-dhorun",
  storageBucket: "batpar-dhorun.firebasestorage.app",
  messagingSenderId: "301385643343",
  appId: "1:301385643343:web:dd79b7e751662e5620c13a"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.register = async function(){
let m=mobile.value,p=password.value,n=name.value;
await setDoc(doc(db,"users",m),{name:n,password:p});
alert("Registered");
}

window.login = async function(){
let m=mobile.value,p=password.value;
let d=await getDoc(doc(db,"users",m));
if(d.exists() && d.data().password==p){
localStorage.setItem("user",m);
showHome();
}else alert("Wrong");
}

window.postComplaint = async function(){
await addDoc(collection(db,"pendingPosts"),{
name:scname.value,
mobile:scmobile.value,
amount:amount.value,
details:details.value,
fb:fb.value,
wa:wa.value,
user:localStorage.getItem("user")
});
alert("Submitted");
}

window.loadPending = async function(){
let q=await getDocs(collection(db,"pendingPosts"));
pending.innerHTML="";
q.forEach(async d=>{
pending.innerHTML+=`
<div class=card>
${d.data().name}
<button class=green onclick="approve('${d.id}')">Approve</button>
<button class=red onclick="reject('${d.id}')">Reject</button>
</div>`
})
}

window.approve=async function(id){
let d=await getDoc(doc(db,"pendingPosts",id));
await addDoc(collection(db,"approvedPosts"),d.data());
await deleteDoc(doc(db,"pendingPosts",id));
loadApproved();
}

window.reject=async function(id){
await deleteDoc(doc(db,"pendingPosts",id));
loadPending();
}

window.loadApproved=async function(){
let q=await getDocs(collection(db,"approvedPosts"));
approved.innerHTML="";
q.forEach(d=>{
approved.innerHTML+=`
<div class="card post">
<h3>${d.data().name}</h3>
<p>${d.data().mobile}</p>
<p>${d.data().amount}</p>
<p>${d.data().details}</p>
</div>`
})
}

window.resetPass=async function(){
let m=umobile.value,np=npass.value;
await updateDoc(doc(db,"users",m),{password:np});
alert("Updated");
}

window.showHome=function(){
loginbox.style.display="none";
home.style.display="block";
loadApproved();
}

</script>
</head>

<body>

<div id=loginbox class=card>
<h2>লগইন করুন</h2>
<input id=name placeholder="Name">
<input id=mobile placeholder="Mobile">
<input id=password placeholder="Password">
<button class=green onclick="register()">Register</button>
<button class=red onclick="login()">Login</button>
</div>

<div id=home style="display:none">

<div class=card>
<h3>Complaint</h3>
<input id=scname placeholder="Scammer Name">
<input id=scmobile placeholder="Mobile">
<input id=amount placeholder="Amount">
<textarea id=details placeholder="Details"></textarea>
<input id=fb placeholder="Facebook ID">
<input id=wa placeholder="WhatsApp">
<button class=green onclick="postComplaint()">Submit</button>
</div>

<div id=approved></div>

<div class=card>
<h3>Admin Panel</h3>
<input id=umobile placeholder="User Mobile">
<input id=npass placeholder="New Password">
<button class=red onclick="resetPass()">Reset Password</button>
<div id=pending></div>
<button onclick="loadPending()">Load Pending</button>
</div>

</div>

</body>
</html>